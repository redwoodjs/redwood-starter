import { GraphQLError } from 'graphql';

const createFilterOperationTypeRule = (allowedOperations) => context => {
    const ops = new Set(allowedOperations);
    return {
        OperationDefinition(node) {
            if (!ops.has(node.operation)) {
                context.reportError(new GraphQLError(`GraphQL operation type "${node.operation}" is not allowed.`, [node]));
            }
        },
    };
};

const useFilterAllowedOperations = (allowedOperations) => {
    return {
        onValidate: ({ addValidationRule }) => {
            addValidationRule(createFilterOperationTypeRule(allowedOperations));
        },
    };
};

export { createFilterOperationTypeRule, useFilterAllowedOperations };
